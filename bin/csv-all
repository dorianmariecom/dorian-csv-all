#!/usr/bin/env ruby
# frozen_string_literal: true

require "csv"
require "dorian-to_struct"

HEADERS = ARGV.detect { |argv| argv == "-h" || argv == "--headers" }

it =
  CSV
    .parse($stdin.each_line.to_a.map(&:strip).join("\n"), headers: !!HEADERS)
    .map { |line| HEADERS ? line.to_h.to_struct : line.to_a }

eval((ARGV - [HEADERS]).join(" "))
